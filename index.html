<!doctype html>
<html>
  <head>
    <title>2d</title>
    <style type="text/css">
      #field {
        width:800px;
        height:600px;
        border:5px solid black;
      }
    </style>
  </head>
  <body>
    <h1>Socket-Fun</h1>
    <p>Open this in 2 different places and watch the sockets update instantly</p>
    <canvas id='field' height='600' width='800'></canvas>
    <script src="socket.io/socket.io.js"></script>
    <script src="zepto.js"></script>
    <script>
      // Generated by CoffeeScript 1.6.2
      (function() {
        window.requestAnimFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
          return window.setTimeout(callback, 1000 / 30);
        };

      }).call(this);

      var socket = io();
      socket.on('places', function(people) {
        console.log('Got a list of ' + people.length + ' people')
        window.people = people
      });
      
      canvas = document.getElementById('field');
      context = canvas.getContext('2d');

      window.main = function() {
        window.render();
        if(window.stop !== true) {
          return window.requestAnimFrame(window.main)
        }
      };

      window.render = function() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        if(typeof(people) != "undefined") {
          window.people.forEach(function(person){
            context.beginPath();
            context.arc(person.x, person.y, 10, 0, 2 * Math.PI, false);
            context.fillStyle = '#00FF00';
            context.fill();
            context.lineWidth = 2;
            context.strokeStyle = '#000000';
            context.stroke();
          });
        }
      };

      canvas.addEventListener('mousedown', function(e) {
        socket.emit('click', { x: e.x, y: e.y })
      }, false);

      main();
    </script>
  </body>
</html>
